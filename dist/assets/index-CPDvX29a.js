import{i as ke,g as Ce,a as Ie,r as f,o as xe,c as X,u as Z,d as E,b as Q,e as Y,s as ue,j as e,C as De,L as Te,U as se,B as Ae,f as pe,h as Le,A as te,k as ge,H as de,l as Re,m as ze,n as ie,p as be,q as fe,M as Me,T as je,t as Ee,v as Oe,P as $e,w as ve,x as Ne,y as ae,X as Pe,z as Ue,D as qe,W as _e,E as Fe,F as Ve,S as Be,G as we,I as Ge,J as ye,K as Ke,N as He,O as Xe,Q as Je,R as We,V as Ze,Y as Qe,Z as Ye,_ as es,$ as ss,a0 as ts,a1 as as,a2 as ls,a3 as ns,a4 as rs,a5 as ds}from"./vendor-DbyGX3LT.js";(function(){const N=document.createElement("link").relList;if(N&&N.supports&&N.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))w(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&w(d)}).observe(document,{childList:!0,subtree:!0});function h(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function w(n){if(n.ep)return;n.ep=!0;const i=h(n);fetch(n.href,i)}})();const is={apiKey:"AIzaSyDFGlm4ixlJ34vg9XT_otqIeKgZT5bmBu8",authDomain:"tsops-webapp-v1.firebaseapp.com",projectId:"tsops-webapp-v1",storageBucket:"tsops-webapp-v1.firebasestorage.app",messagingSenderId:"558840136278",appId:"1:558840136278:web:00e5918a1e98aa70f2f1f7"},Se=ke(is),ne=Ce(Se),I=Ie(Se),os="modulepreload",cs=function(j){return"/"+j},me={},he=function(N,h,w){let n=Promise.resolve();if(h&&h.length>0){document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),u=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));n=Promise.allSettled(h.map(p=>{if(p=cs(p),p in me)return;me[p]=!0;const r=p.endsWith(".css"),m=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${m}`))return;const c=document.createElement("link");if(c.rel=r?"stylesheet":os,r||(c.as="script"),c.crossOrigin="",c.href=p,u&&c.setAttribute("nonce",u),document.head.appendChild(c),r)return new Promise((y,S)=>{c.addEventListener("load",y),c.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${p}`)))})}))}function i(d){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=d,window.dispatchEvent(u),!u.defaultPrevented)throw d}return n.then(d=>{for(const u of d||[])u.status==="rejected"&&i(u.reason);return N().catch(i)})};function xs(j){const[N,h]=f.useState([]),[w,n]=f.useState([]),[i,d]=f.useState([]),[u,p]=f.useState([]),[r,m]=f.useState([]),[c,y]=f.useState([]),[S,t]=f.useState({});f.useEffect(()=>{const a=(_,F)=>{const J=X(I,_);return xe(J,T=>{if(T.empty)F([]);else{const V=T.docs.map(H=>({id:H.id,...H.data()}));_==="logs"&&V.sort((H,le)=>(le.date||"").localeCompare(H.date||"")),_==="actionLogs"&&V.sort((H,le)=>{var oe,ce;return(((oe=le.timestamp)==null?void 0:oe.seconds)||0)-(((ce=H.timestamp)==null?void 0:ce.seconds)||0)}),F(V)}},T=>{console.error(`Error fetching ${_}:`,T),F([])})},l=a("members",h),b=a("tasks",n),M=a("logs",d),k=a("actionLogs",p),q=a("rules",m),W=a("manualScores",y),K=xe(X(I,"roles"),_=>{const F={};_.docs.forEach(J=>F[J.id]=J.data().role),t(F)},_=>console.error("Roles Error:",_));return()=>{l(),b(),M(),k(),q(),W(),K()}},[j]);const v=async(a,l,b)=>{try{await Q(X(I,"actionLogs"),{timestamp:ue(),user:a||"Unknown",action:l,detail:b})}catch{}};return{members:N,tasks:w,logs:i,actionLogs:u,rules:r,manualScores:c,roles:S,handleTaskToggle:async(a,l,b)=>{await Z(E(I,"tasks",a),{completed:!l}),v(b==null?void 0:b.email,"Toggle Task",a)},handleUpdateTaskStatus:async(a,l,b)=>{await Z(E(I,"tasks",a),{status:l}),v(b==null?void 0:b.email,"Update Status",a)},handleAddTask:async(a,l)=>{await Q(X(I,"tasks"),a),v(l==null?void 0:l.email,"Add Task",a.name)},handleEditTask:async(a,l,b)=>{await Z(E(I,"tasks",a),l),v(b==null?void 0:b.email,"Edit Task",a)},handleDeleteTask:async(a,l)=>{await Y(E(I,"tasks",a)),v(l==null?void 0:l.email,"Delete Task",a)},handleAddMember:async(a,l)=>{const b={...a,email:a.email?a.email.trim().toLowerCase():"",name:a.name?a.name.trim():"",position:a.position?a.position.trim():""};let M="staff";if(b.email){const k=b.position.toLowerCase();M=k.includes("manager")||k.includes("หัวหน้า")||k.includes("dgm")||k.includes("dm")?"dgm":"staff"}if(await Q(X(I,"members"),{...b,role:M}),b.email){const k=E(I,"roles",b.email);await he(async()=>{const{setDoc:q}=await import("./vendor-DbyGX3LT.js").then(W=>W.a6);return{setDoc:q}},[]).then(({setDoc:q})=>q(k,{role:M},{merge:!0}))}v(l==null?void 0:l.email,"Add Member",`Added: ${b.name} as ${M}`)},handleEditMember:async(a,l,b)=>{await Z(E(I,"members",a),l),v(b==null?void 0:b.email,"Edit Member",l.name)},handleDeleteMember:async(a,l)=>{await Y(E(I,"members",a)),v(l==null?void 0:l.email,"Delete Member",a)},handleAddLog:async(a,l)=>{await Q(X(I,"logs"),a),v(l==null?void 0:l.email,"Add Log",a.topic)},handleResolveLog:async(a,l,b)=>{await Z(E(I,"logs",a),{status:"solved",resolution:l,solvedBy:b==null?void 0:b.email}),v(b==null?void 0:b.email,"Resolve",a)},handleDeleteLog:async(a,l)=>{await Y(E(I,"logs",a)),v(l==null?void 0:l.email,"Del Log",a)},handleSaveRule:async(a,l)=>{if(a.id){const{id:b,...M}=a;await Z(E(I,"rules",b),M)}else await Q(X(I,"rules"),a);v(l==null?void 0:l.email,"Rule",a.condition)},handleDeleteRule:async(a,l)=>{await Y(E(I,"rules",a)),v(l==null?void 0:l.email,"Del Rule",a)},handleSaveManualScore:async(a,l)=>{await Q(X(I,"manualScores"),{...a,timestamp:ue()}),v(l==null?void 0:l.email,"Score",a.points)},handleDeleteManualScore:async(a,l)=>{await Y(E(I,"manualScores",a)),v(l==null?void 0:l.email,"Del Score",a)},handleSaveRole:async(a,l,b)=>{const M=E(I,"roles",a);await he(async()=>{const{setDoc:k}=await import("./vendor-DbyGX3LT.js").then(q=>q.a6);return{setDoc:k}},[]).then(({setDoc:k})=>k(M,{role:l},{merge:!0})),v(b==null?void 0:b.email,"Role",a)}}}function us({activeTab:j,setActiveTab:N,user:h,role:w,onLogout:n,members:i}){var S;const d=h||{},u=d.displayName||((S=d.email)==null?void 0:S.split("@")[0])||"Guest",p=d.email||"",r=i==null?void 0:i.find(t=>t.email===p),m=(r==null?void 0:r.position)||(r==null?void 0:r.role)||w||"Staff",c=w?w.toLowerCase():"staff",y=[{id:"dashboard",label:"Dashboard",icon:Te},{id:"team",label:"จัดการทีมงาน",icon:se},{id:"dept",label:"ภาพรวมแผนก",icon:Ae},{id:"assign",label:"มอบหมายงาน",icon:pe},{id:"scores",label:"บันทึกคะแนน",icon:Le},{id:"problems",label:"แจ้งปัญหา",icon:te},{id:"rules",label:"กฎระเบียบ",icon:ge},{id:"action_logs",label:"ประวัติการแก้ไข",icon:de,role:["dgm","dm","admin"]}];return e.jsxs("div",{className:"flex flex-col h-full bg-slate-900 text-white shadow-xl",children:[e.jsxs("div",{className:"p-6 border-b border-slate-800",children:[e.jsx("h1",{className:"text-xl font-bold tracking-wider text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-teal-400",children:"TransportOps"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Version 2.0 (Unlocked)"})]}),e.jsx("div",{className:"p-6 bg-slate-800/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-slate-700 rounded-full",children:e.jsx(De,{size:24,className:"text-slate-300"})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:u}),e.jsx("span",{className:"inline-block mt-1 px-2 py-0.5 rounded text-[10px] font-bold bg-blue-900 text-blue-200 uppercase tracking-wide border border-blue-800",children:m})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto py-4",children:e.jsx("nav",{className:"space-y-1 px-3",children:y.map(t=>t.role&&!t.role.includes(c)?null:e.jsxs("button",{onClick:()=>N(t.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 group ${j===t.id?"bg-blue-600 text-white shadow-lg":"text-slate-400 hover:bg-slate-800 hover:text-white"}`,children:[e.jsx(t.icon,{size:18,className:`transition-colors ${j===t.id?"text-white":"text-slate-500 group-hover:text-white"}`}),t.label]},t.id))})}),e.jsx("div",{className:"p-4 border-t border-slate-800",children:e.jsxs("button",{onClick:n,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium text-slate-400 hover:bg-red-500/10 hover:text-red-400 transition border border-transparent hover:border-red-500/20",children:[e.jsx(Re,{size:18})," ออกจากระบบ"]})})]})}const ee=({title:j,value:N,subtext:h,icon:w,colorClass:n,bgClass:i})=>e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-all duration-300",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm font-medium mb-1",children:j}),e.jsx("h3",{className:"text-3xl font-bold text-gray-800",children:N})]}),e.jsx("div",{className:`p-3 rounded-xl ${i} ${n}`,children:e.jsx(w,{size:24})})]}),h&&e.jsxs("div",{className:"mt-4 flex items-center gap-1 text-xs font-medium text-gray-400",children:[e.jsx(je,{size:14,className:"text-green-500"}),e.jsx("span",{children:h})]})]});function ms({members:j,tasks:N,logs:h}){const w=j||[],n=N||[],i=h||[],d=w.length,u=n.length,p=n.filter(t=>t==null?void 0:t.completed).length,r=u>0?Math.round(p/u*100):0,m=i.filter(t=>(t==null?void 0:t.status)==="pending").length,c=i.filter(t=>(t==null?void 0:t.status)==="solved").length,y=n.slice(0,5),S=i.slice(0,5);return e.jsxs("div",{className:"space-y-8 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-end gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-800",children:"Overview Dashboard"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"สรุปภาพรวมการดำเนินงานประจำวัน"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow-sm border border-gray-200 text-sm text-gray-600",children:[e.jsx(ze,{size:16}),new Date().toLocaleDateString("th-TH",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(ee,{title:"พนักงานทั้งหมด",value:d,icon:se,colorClass:"text-blue-600",bgClass:"bg-blue-50",subtext:"Active Members"}),e.jsx(ee,{title:"งานเสร็จสิ้น",value:`${p}/${u}`,icon:ie,colorClass:"text-green-600",bgClass:"bg-green-50",subtext:`Success Rate ${r}%`}),e.jsx(ee,{title:"ปัญหาที่รอแก้ไข",value:m,icon:te,colorClass:"text-red-600",bgClass:"bg-red-50",subtext:`Solved: ${c}`}),e.jsx(ee,{title:"ประสิทธิภาพรวม",value:`${r}%`,icon:be,colorClass:"text-purple-600",bgClass:"bg-purple-50",subtext:"Overall Performance"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-50 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-800 flex items-center gap-2",children:[e.jsx(fe,{className:"text-blue-500",size:20})," งานล่าสุด"]}),e.jsxs("span",{className:"text-xs font-bold px-2 py-1 bg-blue-50 text-blue-600 rounded-lg",children:[y.length," รายการ"]})]}),e.jsx("div",{className:"p-0",children:y.length>0?e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 text-xs uppercase tracking-wider",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 font-semibold",children:"ชื่องาน"}),e.jsx("th",{className:"p-4 font-semibold",children:"พื้นที่/แผนก"}),e.jsx("th",{className:"p-4 font-semibold text-center",children:"สถานะ"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-50",children:y.map((t,v)=>e.jsxs("tr",{className:"hover:bg-slate-50/50 transition-colors",children:[e.jsx("td",{className:"p-4 text-sm font-medium text-slate-700",children:(t==null?void 0:t.name)||"Unknown"}),e.jsxs("td",{className:"p-4 text-sm text-slate-500 flex items-center gap-1",children:[e.jsx(Me,{size:14,className:"text-gray-300"})," ",(t==null?void 0:t.area)||"-"]}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold ${t!=null&&t.completed?"bg-green-100 text-green-700":"bg-orange-100 text-orange-700"}`,children:t!=null&&t.completed?"Completed":"Pending"})})]},(t==null?void 0:t.id)||v))})]}):e.jsx("div",{className:"p-10 text-center text-gray-400",children:"ไม่มีข้อมูลงานล่าสุด"})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-50",children:e.jsxs("h3",{className:"font-bold text-lg text-slate-800 flex items-center gap-2",children:[e.jsx(te,{className:"text-red-500",size:20})," ปัญหาล่าสุด"]})}),e.jsx("div",{className:"p-4 space-y-3",children:S.length>0?S.map((t,v)=>e.jsxs("div",{className:"p-4 rounded-xl bg-red-50/50 border border-red-100 hover:border-red-200 transition-colors cursor-pointer group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-red-600 bg-red-100 px-2 py-0.5 rounded",children:(t==null?void 0:t.dept)||"General"}),e.jsx("span",{className:"text-[10px] text-gray-400",children:t==null?void 0:t.date})]}),e.jsx("h4",{className:"text-sm font-bold text-gray-800 mb-1 group-hover:text-red-700 transition-colors",children:t==null?void 0:t.topic}),e.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:t==null?void 0:t.detail})]},(t==null?void 0:t.id)||v)):e.jsx("div",{className:"p-10 text-center text-gray-400",children:"ไม่มีรายการแจ้งปัญหา"})})]})]})]})}function hs({members:j,onAdd:N,onEdit:h,onDelete:w,currentUserRole:n}){const i=j||[],[d,u]=f.useState(!1),[p,r]=f.useState(null),[m,c]=f.useState({name:"",position:"",dept:"Inbound",tel:"",email:""}),y=()=>{c({name:"",position:"",dept:"Inbound",tel:"",email:""}),r(null),u(!1)},S=s=>{s.preventDefault(),p?h(p,m):N(m),y()},t=s=>{c(s),r(s.id),u(!0)},v=s=>{confirm("ยืนยันการลบ?")&&w(s)},L=["dgm","dm","admin"].includes(n);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(se,{className:"text-blue-600"})," จัดการทีมงาน"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["พนักงานทั้งหมด: ",i.length," คน"]})]}),L&&e.jsxs("button",{onClick:()=>u(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-700 transition shadow-sm",children:[e.jsx(Ee,{size:18})," เพิ่มพนักงาน"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.length>0?i.map((s,$)=>e.jsxs("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-100 flex flex-col hover:shadow-md transition group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center font-bold text-lg border border-blue-100",children:s!=null&&s.name?s.name.charAt(0).toUpperCase():"?"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-800",children:(s==null?void 0:s.name)||"ไม่ระบุชื่อ"}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500",children:[e.jsx(Oe,{size:12})," ",(s==null?void 0:s.position)||(s==null?void 0:s.role)||"Staff"]})]})]}),e.jsx("span",{className:`text-[10px] font-bold px-2 py-1 rounded uppercase ${(s==null?void 0:s.dept)==="Inbound"?"bg-blue-100 text-blue-600":(s==null?void 0:s.dept)==="Outbound"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"}`,children:(s==null?void 0:s.dept)||"General"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 flex-1 border-t border-gray-50 pt-3 mt-1",children:[s!=null&&s.tel?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{size:14,className:"text-gray-400"})," ",s.tel]}):e.jsx("div",{className:"text-xs text-gray-300 italic",children:"ไม่มีเบอร์โทร"}),s!=null&&s.email?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{size:14,className:"text-gray-400"})," ",s.email]}):e.jsx("div",{className:"text-xs text-gray-300 italic",children:"ไม่มีอีเมล"})]}),L&&e.jsxs("div",{className:"flex justify-end gap-2 mt-4 pt-3 border-t border-gray-50 opacity-100 transition",children:[e.jsxs("button",{onClick:()=>t(s),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-bold text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition",children:[e.jsx(Ne,{size:14})," แก้ไข"]}),e.jsxs("button",{onClick:()=>v(s.id),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-bold text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition",children:[e.jsx(ae,{size:14})," ลบ"]})]})]},(s==null?void 0:s.id)||$)):e.jsxs("div",{className:"col-span-full py-16 flex flex-col items-center justify-center text-center bg-white rounded-2xl border-2 border-dashed border-gray-200",children:[e.jsx(se,{size:48,className:"text-gray-200 mb-4"}),e.jsx("h3",{className:"text-lg font-bold text-gray-400",children:"ยังไม่มีข้อมูลพนักงาน"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:'กดปุ่ม "เพิ่มพนักงาน" เพื่อเริ่มต้น'})]})}),d&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-6 shadow-2xl animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:p?"แก้ไขข้อมูล":"เพิ่มพนักงานใหม่"}),e.jsx("button",{onClick:y,children:e.jsx(Pe,{className:"text-gray-400 hover:text-gray-600"})})]}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500",children:"ชื่อ-นามสกุล"}),e.jsx("input",{required:!0,className:"w-full border rounded-lg px-3 py-2 mt-1",value:m.name,onChange:s=>c({...m,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500",children:"ตำแหน่ง (Position)"}),e.jsx("input",{required:!0,className:"w-full border rounded-lg px-3 py-2 mt-1",value:m.position,onChange:s=>c({...m,position:s.target.value}),placeholder:"เช่น Driver, Admin..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500",children:"แผนก"}),e.jsxs("select",{className:"w-full border rounded-lg px-3 py-2 mt-1",value:m.dept,onChange:s=>c({...m,dept:s.target.value}),children:[e.jsx("option",{value:"Inbound",children:"Inbound"}),e.jsx("option",{value:"Outbound",children:"Outbound"}),e.jsx("option",{value:"Internal",children:"Internal"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500",children:"เบอร์โทร"}),e.jsx("input",{className:"w-full border rounded-lg px-3 py-2 mt-1",value:m.tel,onChange:s=>c({...m,tel:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500",children:"อีเมล (ถ้ามี)"}),e.jsx("input",{className:"w-full border rounded-lg px-3 py-2 mt-1",value:m.email,onChange:s=>c({...m,email:s.target.value})})]}),e.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white py-2.5 rounded-lg hover:bg-blue-700 font-bold shadow-lg shadow-blue-200 mt-2",children:"บันทึกข้อมูล"})]})]})})]})}function ps({members:j,tasks:N,onTaskToggle:h}){const w=j||[],n=N||[],i=u=>({team:w.filter(p=>(p==null?void 0:p.dept)===u),work:n.filter(p=>(p==null?void 0:p.area)===u)}),d=({title:u,icon:p,color:r,data:m})=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:`p-4 border-b border-gray-100 bg-opacity-10 ${r} flex justify-between items-center`,children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-800 font-bold text-lg",children:[p," ",u]}),e.jsxs("div",{className:"text-xs font-bold bg-white px-2 py-1 rounded-full text-slate-500 shadow-sm",children:[m.team.length," คน | ",m.work.length," งาน"]})]}),e.jsxs("div",{className:"p-5 flex-1 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-3",children:"Members"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.team.length>0?m.team.map((c,y)=>e.jsx("span",{className:"px-2.5 py-1 text-xs font-medium bg-slate-50 text-slate-600 rounded-md border border-slate-100",children:c.name},c.id||y)):e.jsx("span",{className:"text-xs text-gray-300 italic",children:"- ไม่มีสมาชิก -"})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-3",children:"Tasks"}),e.jsx("div",{className:"space-y-2",children:m.work.length>0?m.work.map((c,y)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-50 rounded-lg border border-slate-100 hover:border-blue-200 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:c.completed,onChange:()=>h(c.id,c.completed),className:"mt-0.5 rounded text-blue-600 cursor-pointer"}),e.jsx("span",{className:`text-sm ${c.completed?"line-through text-gray-400":"text-slate-700"}`,children:c.name})]},c.id||y)):e.jsx("div",{className:"text-center text-xs text-gray-300 py-4 italic",children:"- ไม่มีงานค้าง -"})})]})]})]});return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Department Overview"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 items-start",children:[e.jsx(d,{title:"Inbound",icon:e.jsx(Ue,{className:"text-blue-600"}),color:"bg-blue-500",data:i("Inbound")}),e.jsx(d,{title:"Outbound",icon:e.jsx(qe,{className:"text-green-600"}),color:"bg-green-500",data:i("Outbound")}),e.jsx(d,{title:"Internal",icon:e.jsx(_e,{className:"text-purple-600"}),color:"bg-purple-500",data:i("Internal")})]})]})}function gs({members:j,manualScores:N,rules:h,onAddScore:w,onDeleteScore:n,currentUserRole:i}){var R,P,O,U;const d=j||[],u=N||[],p=h||[],[r,m]=f.useState(""),[c,y]=f.useState(""),[S,t]=f.useState(""),[v,L]=f.useState(""),s=d.map(x=>{const C=u.filter(D=>D.memberId===x.id).reduce((D,z)=>D+(parseInt(z.points)||0),0);return{...x,totalScore:C}}).sort((x,C)=>C.totalScore-x.totalScore),$=x=>{x.preventDefault();const C=p.find(o=>o.id===c),D=parseInt(C?C.points:S),z=C?C.condition:v||"Custom Score";if(!r||isNaN(D))return alert("กรุณาระบุข้อมูลให้ครบถ้วน");w({memberId:r,points:D,reason:z,date:new Date().toISOString().split("T")[0]}),t(""),L("")};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-xl border border-yellow-100 flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-yellow-100 rounded-full text-yellow-600",children:e.jsx(Fe,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-yellow-700 font-bold uppercase",children:"Top Performer"}),e.jsx("p",{className:"font-bold text-slate-800",children:((R=s[0])==null?void 0:R.name)||"-"}),e.jsxs("p",{className:"text-xs text-slate-500",children:[((P=s[0])==null?void 0:P.totalScore)||0," คะแนน"]})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-100 flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-full text-blue-600",children:e.jsx(je,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-700 font-bold uppercase",children:"Average Score"}),e.jsxs("p",{className:"font-bold text-slate-800",children:[s.length>0?Math.round(s.reduce((x,C)=>x+C.totalScore,0)/s.length):0," คะแนน"]})]})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-xl border border-red-100 flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-red-100 rounded-full text-red-600",children:e.jsx(Ve,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-700 font-bold uppercase",children:"Needs Improvement"}),e.jsx("p",{className:"font-bold text-slate-800",children:((O=s[s.length-1])==null?void 0:O.name)||"-"}),e.jsxs("p",{className:"text-xs text-slate-500",children:[((U=s[s.length-1])==null?void 0:U.totalScore)||0," คะแนน"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 h-fit",children:[e.jsxs("h3",{className:"font-bold text-slate-700 mb-4 flex items-center gap-2",children:[e.jsx(Be,{size:18,className:"text-yellow-500"})," ให้คะแนน"]}),e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"พนักงาน"}),e.jsxs("select",{required:!0,className:"w-full border rounded-lg px-3 py-2 bg-slate-50",value:r,onChange:x=>m(x.target.value),children:[e.jsx("option",{value:"",children:"-- เลือกพนักงาน --"}),d.map(x=>e.jsx("option",{value:x.id,children:x.name},x.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"เลือกตามกฎ"}),e.jsxs("select",{className:"w-full border rounded-lg px-3 py-2",value:c,onChange:x=>y(x.target.value),children:[e.jsx("option",{value:"",children:"-- กำหนดเอง --"}),p.map(x=>e.jsxs("option",{value:x.id,children:[x.condition," (",x.points,")"]},x.id))]})]}),!c&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",placeholder:"คะแนน (+/-)",className:"w-full border rounded-lg px-3 py-2",value:S,onChange:x=>t(x.target.value)}),e.jsx("input",{type:"text",placeholder:"เหตุผล",className:"w-full border rounded-lg px-3 py-2",value:v,onChange:x=>L(x.target.value)})]}),e.jsx("button",{type:"submit",className:"w-full bg-slate-800 text-white py-2.5 rounded-lg hover:bg-slate-900 font-bold shadow-lg",children:"บันทึก"})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b bg-slate-50/50",children:e.jsx("h3",{className:"font-bold text-slate-700",children:"อันดับคะแนนรวม"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-white text-gray-500 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"อันดับ"}),e.jsx("th",{className:"p-3",children:"ชื่อ"}),e.jsx("th",{className:"p-3",children:"แผนก"}),e.jsx("th",{className:"p-3 text-right",children:"คะแนนรวม"})]})}),e.jsx("tbody",{className:"divide-y",children:s.slice(0,5).map((x,C)=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsxs("td",{className:"p-3 pl-5 font-bold text-blue-600",children:["#",C+1]}),e.jsx("td",{className:"p-3 font-medium",children:x.name}),e.jsx("td",{className:"p-3 text-gray-500 text-xs",children:x.dept}),e.jsx("td",{className:`p-3 text-right font-bold ${x.totalScore>=0?"text-green-600":"text-red-600"}`,children:x.totalScore})]},x.id))})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b bg-slate-50/50 flex justify-between",children:e.jsxs("h3",{className:"font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(de,{size:16})," รายการล่าสุด"]})}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:u.length>0?u.slice(0,10).map(x=>{var C;return e.jsxs("div",{className:"p-3 border-b border-gray-50 flex justify-between items-center hover:bg-slate-50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm text-slate-800",children:((C=d.find(D=>D.id===x.memberId))==null?void 0:C.name)||"Unknown"}),e.jsx("p",{className:"text-xs text-gray-500",children:x.reason})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:`font-bold ${x.points>0?"text-green-600":"text-red-600"}`,children:[x.points>0?"+":"",x.points]}),e.jsx("p",{className:"text-[10px] text-gray-400",children:x.timestamp?new Date(x.timestamp.seconds*1e3).toLocaleDateString("th-TH"):"-"}),["dgm","dm","admin"].includes(i)&&e.jsx("button",{onClick:()=>n(x.id),className:"text-[10px] text-red-400 underline ml-2",children:"ลบ"})]})]},x.id)}):e.jsx("p",{className:"text-center p-4 text-gray-400 text-sm",children:"ยังไม่มีข้อมูล"})})]})]})]})]})}function bs({logs:j,onAddLog:N,onResolveLog:h,onDeleteLog:w,currentDate:n,askAiSolution:i,showToast:d,userEmail:u,currentUserRole:p,aiLoading:r}){const[m,c]=f.useState(""),[y,S]=f.useState(""),[t,v]=f.useState("Inbound"),[L,s]=f.useState("pending"),[$,R]=f.useState(!1),[P,O]=f.useState(""),[U,x]=f.useState(null),[C,D]=f.useState(!1),z=g=>{g.preventDefault(),N({topic:m,detail:y,dept:t,date:n,status:"pending",createdBy:u||"Unknown"}),c(""),S(""),d("บันทึกปัญหาเรียบร้อยแล้ว")},o=g=>{x(g),R(!0)},A=async()=>{if(U)try{D(!0),await h(U,P),R(!1),O(""),x(null),d("ปิดงานเรียบร้อยแล้ว")}catch(g){console.error(g),d("เกิดข้อผิดพลาดในการปิดงาน")}finally{D(!1)}},B=async g=>{if(window.confirm(`⚠️ คุณต้องการลบรายการปัญหานี้ใช่หรือไม่?
(การกระทำนี้ไม่สามารถย้อนกลับได้)`))try{await w(g),d("ลบรายการเรียบร้อยแล้ว")}catch(a){console.error(a),d("เกิดข้อผิดพลาดในการลบ")}},G=j.filter(g=>g.status===L);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(te,{className:"text-red-500"})," Problem Log"]}),$&&e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black bg-opacity-50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md p-6 animate-fade-in",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(ie,{className:"text-green-600"})," บันทึกการปิดงาน"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"หมายเหตุ / สรุปการแก้ไข"}),e.jsx("textarea",{className:"w-full border rounded px-3 py-2 h-24",value:P,onChange:g=>O(g.target.value),placeholder:"ระบุรายละเอียดการแก้ไข..."})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-4",children:[e.jsx("button",{onClick:()=>R(!1),disabled:C,className:"px-4 py-2 text-gray-500 hover:bg-gray-100 rounded",children:"ยกเลิก"}),e.jsxs("button",{onClick:A,disabled:C,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 flex items-center gap-2",children:[C&&e.jsx(we,{size:16,className:"animate-spin"}),"ยืนยันปิดงาน"]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm h-fit",children:[e.jsx("h3",{className:"font-bold mb-4 text-gray-800",children:"แจ้งปัญหาใหม่"}),e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1 uppercase tracking-wide",children:"หัวข้อ"}),e.jsx("input",{required:!0,type:"text",className:"w-full border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-red-200 focus:border-red-400 outline-none transition",value:m,onChange:g=>c(g.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1 uppercase tracking-wide",children:"รายละเอียด"}),e.jsx("textarea",{required:!0,className:"w-full border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-red-200 focus:border-red-400 outline-none transition",rows:"3",value:y,onChange:g=>S(g.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1 uppercase tracking-wide",children:"แผนก"}),e.jsxs("select",{className:"w-full border rounded-lg px-3 py-2 text-sm bg-white",value:t,onChange:g=>v(g.target.value),children:[e.jsx("option",{value:"Inbound",children:"Inbound"}),e.jsx("option",{value:"Outbound",children:"Outbound"}),e.jsx("option",{value:"Internal",children:"Internal"})]})]}),e.jsx("button",{type:"submit",className:"w-full bg-red-600 text-white py-2.5 rounded-lg hover:bg-red-700 transition font-medium text-sm shadow-md shadow-red-200",children:"บันทึกปัญหา"})]})]}),e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-sm overflow-hidden flex flex-col max-h-[600px]",children:[e.jsxs("div",{className:"flex border-b",children:[e.jsxs("button",{onClick:()=>s("pending"),className:`flex-1 py-3 text-sm font-bold text-center border-b-2 transition ${L==="pending"?"border-red-500 text-red-600 bg-red-50":"border-transparent text-gray-500 hover:bg-gray-50"}`,children:["รอดำเนินการ (",j.filter(g=>g.status==="pending").length,")"]}),e.jsxs("button",{onClick:()=>s("solved"),className:`flex-1 py-3 text-sm font-bold text-center border-b-2 transition ${L==="solved"?"border-green-500 text-green-600 bg-green-50":"border-transparent text-gray-500 hover:bg-gray-50"}`,children:["ปิดงานแล้ว (",j.filter(g=>g.status==="solved").length,")"]})]}),e.jsxs("div",{className:"divide-y overflow-y-auto flex-1",children:[G.length===0?e.jsx("div",{className:"p-10 text-center text-gray-400",children:"ไม่มีรายการในสถานะนี้"}):null,[...G].reverse().map((g,a)=>e.jsx("div",{className:"p-4 hover:bg-gray-50 transition relative group",children:e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-bold text-gray-800 text-sm",children:g.topic}),e.jsxs("span",{className:"text-[10px] text-gray-400",children:["โดย: ",g.createdBy]}),g.status==="pending"&&e.jsxs("button",{onClick:()=>i(g),disabled:r,className:"flex items-center gap-1 px-1.5 py-0.5 bg-indigo-50 text-indigo-600 text-[10px] rounded border border-indigo-100 hover:bg-indigo-100 transition whitespace-nowrap",children:[e.jsx(Ge,{size:10})," ",r?"Thinking...":"Ask AI"]})]}),e.jsx("p",{className:"text-sm text-gray-600 break-words",children:g.detail}),g.status==="solved"&&e.jsxs("div",{className:"mt-2 text-xs bg-green-50 p-2 rounded border border-green-100 text-green-800",children:[e.jsx("strong",{children:"แก้ไขแล้วโดย:"})," ",g.solvedBy," ",e.jsx("br",{}),e.jsx("strong",{children:"หมายเหตุ:"})," ",g.resolution]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold tracking-wider bg-gray-100 px-2 py-0.5 rounded text-gray-600",children:g.dept}),e.jsx("span",{className:"text-[10px] text-gray-400 px-2 py-0.5",children:g.date})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[g.status==="pending"?["dgm","dm"].includes(p)&&e.jsx("button",{onClick:()=>o(g.docId||g.id),className:"px-3 py-1 bg-yellow-100 text-yellow-700 text-xs rounded hover:bg-yellow-200 transition font-bold",children:"ปิดงาน"}):e.jsx("span",{className:"px-2.5 py-1 rounded-full text-[10px] font-bold tracking-wide whitespace-nowrap bg-green-100 text-green-700",children:"SOLVED"}),e.jsx("button",{onClick:()=>B(g.docId||g.id),className:"p-1.5 text-gray-300 hover:text-red-500 hover:bg-red-50 rounded-full transition",title:"ลบรายการ",children:e.jsx(ae,{size:14})})]})]})},g.docId||g.id||a))]})]})]})]})}function fs({members:j,tasks:N,onAddTask:h,onEditTask:w,onDeleteTask:n,onUpdateStatus:i,currentUserRole:d}){const u=j||[],p=N||[],[r,m]=f.useState(!1),[c,y]=f.useState(null),[S,t]=f.useState({name:"",area:"Inbound",assigneeId:"",status:"pending",deadline:""}),[v,L]=f.useState(""),[s,$]=f.useState("All"),[R,P]=f.useState("All"),O=()=>{t({name:"",area:"Inbound",assigneeId:"",status:"pending",deadline:""}),y(null),m(!1)},U=o=>{o.preventDefault(),c?w(c.id,S):h({...S,completed:!1,createdAt:new Date().toISOString()}),O()},x=o=>{y(o),t({name:o.name||"",area:o.area||"Inbound",assigneeId:o.assigneeId||"",status:o.status||"pending",deadline:o.deadline||""}),m(!0)},C=o=>{var A;return((A=u.find(B=>B.id===o))==null?void 0:A.name)||"ไม่ระบุ"},D=p.filter(o=>{var a;const A=(a=o.name)==null?void 0:a.toLowerCase().includes(v.toLowerCase()),B=s==="All"||o.area===s,G=o.status==="done"||o.completed;return A&&B&&(R==="All"?!0:R==="Done"?G:!G)}),z=["dgm","dm","admin"].includes(d);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(pe,{className:"text-blue-600"})," มอบหมายงาน"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[D.length," รายการที่แสดง"]})]}),z&&e.jsxs("button",{onClick:()=>m(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-700 shadow-sm transition",children:[e.jsx(ye,{size:18})," สร้างงานใหม่"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col md:flex-row gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 w-full",children:[e.jsx(Ke,{className:"absolute left-3 top-2.5 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"ค้นหาชื่องาน...",className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-100 outline-none text-sm",value:v,onChange:o=>L(o.target.value)})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs("select",{className:"border rounded-lg px-3 py-2 text-sm bg-slate-50 outline-none",value:s,onChange:o=>$(o.target.value),children:[e.jsx("option",{value:"All",children:"ทุกพื้นที่"}),e.jsx("option",{value:"Inbound",children:"Inbound"}),e.jsx("option",{value:"Outbound",children:"Outbound"}),e.jsx("option",{value:"Internal",children:"Internal"})]}),e.jsxs("select",{className:"border rounded-lg px-3 py-2 text-sm bg-slate-50 outline-none",value:R,onChange:o=>P(o.target.value),children:[e.jsx("option",{value:"All",children:"ทุกสถานะ"}),e.jsx("option",{value:"Pending",children:"กำลังทำ"}),e.jsx("option",{value:"Done",children:"เสร็จแล้ว"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:D.map(o=>{const A=o.status==="done"||o.completed;return e.jsxs("div",{className:`bg-white p-4 rounded-xl shadow-sm border transition hover:shadow-md ${A?"border-green-100 bg-green-50/30":"border-gray-100"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold uppercase ${o.area==="Inbound"?"bg-blue-100 text-blue-700":o.area==="Outbound"?"bg-orange-100 text-orange-700":"bg-purple-100 text-purple-700"}`,children:o.area}),z&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>x(o),className:"p-1.5 text-gray-400 hover:text-blue-600 rounded-full",children:e.jsx(Ne,{size:14})}),e.jsx("button",{onClick:()=>confirm("ลบงานนี้?")&&n(o.id),className:"p-1.5 text-gray-400 hover:text-red-600 rounded-full",children:e.jsx(ae,{size:14})})]})]}),e.jsx("h3",{className:`font-bold text-slate-800 mb-1 ${A?"line-through text-slate-400":""}`,children:o.name}),e.jsx("div",{className:"flex items-center gap-2 mb-4 text-xs text-gray-500",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-slate-200 flex items-center justify-center text-[10px] font-bold text-slate-600",children:C(o.assigneeId).charAt(0)}),C(o.assigneeId)]})}),e.jsx("div",{className:"pt-3 border-t border-gray-100 flex justify-between items-center",children:e.jsxs("button",{onClick:()=>z&&i(o.id,A?"pending":"done"),disabled:!z,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-bold transition w-full justify-center ${A?"bg-green-500 text-white hover:bg-green-600":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:[A?e.jsx(ie,{size:14}):e.jsx(fe,{size:14}),A?"เสร็จสิ้น":"รอการทำงาน"]})})]},o.id)})}),D.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-400 bg-white rounded-xl border border-dashed",children:[e.jsx(He,{size:40,className:"mx-auto mb-2 opacity-20"}),e.jsx("p",{children:"ไม่พบรายการงานตามเงื่อนไข"})]}),r&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-6 shadow-2xl animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:c?"แก้ไขงาน":"มอบหมายงานใหม่"}),e.jsx("button",{onClick:O,children:e.jsx(Xe,{className:"text-gray-400 hover:text-gray-600"})})]}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"ชื่องาน"}),e.jsx("input",{required:!0,className:"w-full border rounded-lg px-3 py-2",value:S.name,onChange:o=>t({...S,name:o.target.value}),placeholder:"เช่น จัดเรียงสินค้า..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"พื้นที่"}),e.jsxs("select",{className:"w-full border rounded-lg px-3 py-2",value:S.area,onChange:o=>t({...S,area:o.target.value}),children:[e.jsx("option",{value:"Inbound",children:"Inbound"}),e.jsx("option",{value:"Outbound",children:"Outbound"}),e.jsx("option",{value:"Internal",children:"Internal"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"ผู้รับผิดชอบ"}),e.jsxs("select",{className:"w-full border rounded-lg px-3 py-2",value:S.assigneeId,onChange:o=>t({...S,assigneeId:o.target.value}),children:[e.jsx("option",{value:"",children:"-- ไม่ระบุ --"}),u.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]})]})]}),e.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white py-2.5 rounded-lg hover:bg-blue-700 font-bold shadow-lg shadow-blue-200 transition",children:"บันทึกข้อมูล"})]})]})})]})}function js({logs:j}){const N=j||[];return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(de,{className:"text-blue-600"})," Activity Logs"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:N.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-gray-100 text-xs uppercase text-gray-500 font-bold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"เวลา"}),e.jsx("th",{className:"p-4",children:"ผู้ใช้งาน"}),e.jsx("th",{className:"p-4",children:"การกระทำ"}),e.jsx("th",{className:"p-4",children:"รายละเอียด"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-50 text-sm",children:N.map((h,w)=>e.jsxs("tr",{className:"hover:bg-slate-50/50 transition",children:[e.jsx("td",{className:"p-4 text-gray-500 text-xs whitespace-nowrap",children:h.timestamp?new Date(h.timestamp.seconds*1e3).toLocaleString("th-TH"):"-"}),e.jsx("td",{className:"p-4 font-bold text-slate-700",children:h.user}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"px-2 py-1 rounded bg-blue-50 text-blue-700 text-xs font-bold border border-blue-100",children:h.action})}),e.jsx("td",{className:"p-4 text-gray-600 max-w-xs truncate",title:h.detail,children:h.detail})]},h.id||w))})]})}):e.jsxs("div",{className:"p-12 text-center text-gray-400 flex flex-col items-center gap-3",children:[e.jsx(be,{size:40,className:"text-gray-200"}),e.jsx("p",{children:"ยังไม่มีประวัติการใช้งาน"})]})})]})}function vs({rules:j,onSave:N,onDelete:h,currentUserRole:w}){const n=j||[],[i,d]=f.useState({condition:"",points:-5}),u=r=>{r.preventDefault(),N(i),d({condition:"",points:-5})},p=["dgm","dm","admin"].includes(w);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(ge,{className:"text-blue-600"})," กฎระเบียบและบทลงโทษ"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:n.length>0?n.map((r,m)=>e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex justify-between items-center hover:shadow-md transition group",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${r.points>0?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:r.points>0?e.jsx(Je,{size:20}):e.jsx(We,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-800",children:r.condition}),e.jsxs("p",{className:"text-xs text-slate-500",children:["ผลกระทบ: ",e.jsxs("span",{className:r.points>0?"text-green-600 font-bold":"text-red-600 font-bold",children:[r.points>0?"+":"",r.points," คะแนน"]})]})]})]}),p&&e.jsx("button",{onClick:()=>h(r.id),className:"p-2 text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition",children:e.jsx(ae,{size:18})})]},r.id||m)):e.jsx("div",{className:"text-center p-10 text-gray-400 bg-white rounded-xl border border-dashed",children:"ยังไม่มีกฎระเบียบ"})}),p&&e.jsxs("div",{className:"bg-slate-800 text-white p-6 rounded-2xl h-fit shadow-xl",children:[e.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2",children:[e.jsx(ye,{size:18})," เพิ่มกฎระเบียบใหม่"]}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1",children:"เงื่อนไข/การกระทำ"}),e.jsx("textarea",{required:!0,rows:"3",className:"w-full bg-slate-700 border-none rounded-lg px-3 py-2 text-white placeholder-slate-500",placeholder:"เช่น มาสายเกิน 15 นาที...",value:i.condition,onChange:r=>d({...i,condition:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1",children:"คะแนน (ใส่ลบเพื่อตัดแต้ม)"}),e.jsx("input",{required:!0,type:"number",className:"w-full bg-slate-700 border-none rounded-lg px-3 py-2 text-white placeholder-slate-500",placeholder:"-10",value:i.points,onChange:r=>d({...i,points:parseInt(r.target.value)})})]}),e.jsx("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-500 py-2.5 rounded-lg font-bold transition shadow-lg shadow-blue-900/50",children:"บันทึกกฎระเบียบ"})]})]})]})]})}function Ns(){const[j,N]=f.useState(""),[h,w]=f.useState(""),[n,i]=f.useState(!1),[d,u]=f.useState(""),p=async r=>{r.preventDefault(),i(!0),u("");try{await Ye(ne,j,h)}catch(m){console.error("Login Failed:",m),m.code==="auth/invalid-credential"||m.code==="auth/user-not-found"||m.code==="auth/wrong-password"?u("อีเมลหรือรหัสผ่านไม่ถูกต้อง"):m.code==="auth/too-many-requests"?u("ล็อกอินผิดหลายครั้ง กรุณารอสักครู่"):u("เกิดข้อผิดพลาดในการเชื่อมต่อ")}finally{i(!1)}};return e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden flex flex-col md:flex-row",children:e.jsxs("div",{className:"w-full p-8 md:p-10",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800 tracking-tight",children:"TransportOPS"}),e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"เข้าสู่ระบบเพื่อจัดการงานขนส่ง"})]}),e.jsxs("form",{onSubmit:p,className:"space-y-5",children:[d&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-600 text-xs p-3 rounded-lg flex items-center gap-2",children:[e.jsx(Ze,{size:16})," ",d]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-bold text-slate-700 uppercase tracking-wider",children:"อีเมล"}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"email",required:!0,className:"w-full pl-10 pr-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition text-sm",placeholder:"name@company.com",value:j,onChange:r=>N(r.target.value)})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-bold text-slate-700 uppercase tracking-wider",children:"รหัสผ่าน"}),e.jsxs("div",{className:"relative",children:[e.jsx(Qe,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"password",required:!0,className:"w-full pl-10 pr-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition text-sm",placeholder:"••••••••",value:h,onChange:r=>w(r.target.value)})]})]}),e.jsx("button",{type:"submit",disabled:n,className:"w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-2.5 rounded-lg transition shadow-lg hover:shadow-xl disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:n?e.jsx(we,{className:"animate-spin",size:20}):"เข้าสู่ระบบ"})]}),e.jsx("p",{className:"mt-8 text-center text-xs text-slate-400",children:"© 2024 Transport Operations System"})]})})})}let re=null;try{re=new es("AIzaSyDFGlm4ixlJ34vg9XT_otqIeKgZT5bmBu8")}catch{}function ws(){var F,J;const[j,N]=f.useState(null),[h,w]=f.useState(null),[n,i]=f.useState("dashboard"),[d,u]=f.useState(!0),[p,r]=f.useState(!1),m=xs(j||h)||{},{members:c=[],tasks:y=[],logs:S=[],actionLogs:t=[],rules:v=[],manualScores:L=[],roles:s={},handleTaskToggle:$,handleUpdateTaskStatus:R,handleAddTask:P,handleEditTask:O,handleDeleteTask:U,handleAddMember:x,handleEditMember:C,handleDeleteMember:D,handleAddLog:z,handleResolveLog:o,handleDeleteLog:A,handleSaveRule:B,handleDeleteRule:G,handleSaveManualScore:g,handleDeleteManualScore:a,handleSaveRole:l}=m;f.useEffect(()=>{const T=ss(ne,V=>N(V));return()=>T()},[]);const b=async()=>{await ns(ne),w(null)},M=T=>ls.success(T),k=T=>(...V)=>{if(T)return T(...V,j||h)},q="admin@tsops.com",W=(F=j||h)==null?void 0:F.email,K=W===q?"dgm":(s==null?void 0:s[W])||"staff",_=async T=>{if(!re)return alert("API Key Missing");r(!0);try{const H=await re.getGenerativeModel({model:"gemini-pro"}).generateContent(`แนะนำวิธีแก้ปัญหา: ${T.topic} ${T.detail}`);alert(`AI Suggestion:
${H.response.text()}`)}catch{alert("AI Error")}finally{r(!1)}};return!j&&!h?e.jsx(Ns,{onLogin:T=>w(T)}):e.jsxs("div",{className:"flex h-screen bg-gray-50 font-sans text-gray-900 overflow-hidden",children:[e.jsx(ts,{position:"top-right"}),e.jsx("div",{className:`fixed inset-y-0 left-0 z-50 w-64 bg-slate-900 text-white transform transition-transform duration-300 lg:static lg:translate-x-0 ${d?"translate-x-0":"-translate-x-full"}`,children:e.jsx(us,{activeTab:n,setActiveTab:T=>{i(T),u(!1)},user:j||h,role:K,onLogout:b,members:c})}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 overflow-hidden",children:[e.jsxs("div",{className:"lg:hidden bg-white p-4 shadow-sm flex items-center justify-between",children:[e.jsx("span",{className:"font-bold text-lg text-slate-800",children:"TransportOps"}),e.jsx("button",{onClick:()=>u(!d),className:"p-2 text-gray-600",children:e.jsx(as,{})})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4 lg:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[n==="dashboard"&&e.jsx(ms,{members:c||[],tasks:y||[],logs:S||[]}),n==="team"&&e.jsx(hs,{members:c||[],onAdd:k(x),onEdit:k(C),onDelete:k(D),currentUserRole:K}),n==="dept"&&e.jsx(ps,{members:c||[],tasks:y||[],onTaskToggle:k($)}),n==="scores"&&e.jsx(gs,{members:c||[],manualScores:L||[],rules:v||[],tasks:y||[],onAddScore:k(g),onDeleteScore:k(a),currentUserRole:K}),n==="problems"&&e.jsx(bs,{logs:S||[],onAddLog:k(z),onResolveLog:k(o),onDeleteLog:k(A),currentDate:new Date().toLocaleDateString("th-TH"),askAiSolution:_,showToast:M,userEmail:(J=j||h)==null?void 0:J.email,currentUserRole:K,aiLoading:p}),n==="assign"&&e.jsx(fs,{members:c||[],tasks:y||[],onAddTask:k(P),onEditTask:k(O),onDeleteTask:k(U),onUpdateStatus:k(R),currentUserRole:K}),n==="action_logs"&&e.jsx(js,{logs:t||[]}),n==="rules"&&e.jsx(vs,{rules:v||[],onSave:k(B),onDelete:k(G),currentUserRole:K,roles:s||{},onSaveRole:k(l)})]})})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden",onClick:()=>u(!1)})]})}rs.createRoot(document.getElementById("root")).render(e.jsx(ds.StrictMode,{children:e.jsx(ws,{})}));
