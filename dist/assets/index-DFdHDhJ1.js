import{i as Ce,g as Ie,a as De,r as p,q as le,c as E,o as ce,b as xe,u as X,d as M,e as J,f as Y,s as ne,h as ue,j as e,C as Le,L as Te,U as Z,B as Ae,k as ge,l as ze,A as de,m as be,H as ie,n as Me,p as Re,t as me,v as fe,w as Oe,T as je,x as $e,y as Ee,z as Ue,P as Pe,M as ve,D as Ne,E as te,X as qe,F as Ve,G as Be,W as Fe,I as Ge,J as He,S as We,K as we,N as ye,O as Ke,Q as Se,R as Qe,V as _e,Y as Xe,Z as Je,_ as Ye,$ as Ze,a0 as es,a1 as ss,a2 as ts,a4 as as,a5 as ls,a6 as ns,a7 as rs,a8 as ds,a9 as is,aa as os}from"./vendor-CR7BL-KG.js";(function(){const j=document.createElement("link").relList;if(j&&j.supports&&j.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))f(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const h of i.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&f(h)}).observe(document,{childList:!0,subtree:!0});function c(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function f(l){if(l.ep)return;l.ep=!0;const i=c(l);fetch(l.href,i)}})();const cs={apiKey:void 0,authDomain:void 0,projectId:void 0,storageBucket:void 0,messagingSenderId:void 0,appId:void 0},ke=Ce(cs),re=Ie(ke),C=De(ke);function xs(g){const[j,c]=p.useState([]),[f,l]=p.useState([]),[i,h]=p.useState([]),[N,v]=p.useState([]),[o,x]=p.useState([]),[u,n]=p.useState([]),[w,y]=p.useState({});p.useEffect(()=>{if(!g)return;const t=(_,H,K=null)=>{const ee=E(C,_);return xe(K||ee,V=>{const ae=V.docs.map(oe=>({id:oe.id,...oe.data()}));H(ae)},V=>{console.error(`Error fetching ${_}:`,V),H([])})},a=t("members",c),b=t("tasks",l,le(E(C,"tasks"))),D=t("logs",h,le(E(C,"logs"),ce("date","desc"))),I=t("actionLogs",v,le(E(C,"actionLogs"),ce("timestamp","desc"))),W=t("rules",x),Q=t("manualScores",n),G=xe(E(C,"roles"),_=>{const H={};_.docs.forEach(K=>H[K.id]=K.data().role),y(H)});return()=>{a(),b(),D(),I(),W(),Q(),G()}},[g]);const S=async(t,a,b)=>{try{await J(E(C,"actionLogs"),{timestamp:ue(),user:t||"Unknown",action:a,detail:b})}catch(D){console.error("Log Error",D)}};return{members:j,tasks:f,logs:i,actionLogs:N,rules:o,manualScores:u,roles:w,handleTaskToggle:async(t,a,b)=>{await X(M(C,"tasks",t),{completed:!a}),S(b==null?void 0:b.email,"Toggle Task",`Task ID: ${t}`)},handleUpdateTaskStatus:async(t,a,b)=>{await X(M(C,"tasks",t),{status:a}),S(b==null?void 0:b.email,"Update Status",`Task ${t} -> ${a}`)},handleAddTask:async(t,a)=>{await J(E(C,"tasks"),t),S(a==null?void 0:a.email,"Add Task",`Task: ${t.name}`)},handleEditTask:async(t,a,b)=>{await X(M(C,"tasks",t),a),S(b==null?void 0:b.email,"Edit Task",`Task: ${t}`)},handleDeleteTask:async(t,a)=>{await Y(M(C,"tasks",t)),S(a==null?void 0:a.email,"Delete Task",`Task: ${t}`)},handleAddMember:async(t,a)=>{const b=t.email?t.email.trim().toLowerCase():"",D=t.position?t.position.trim():"",W=D.toLowerCase().includes("manager")||D.toLowerCase().includes("หัวหน้า")||D.toLowerCase().includes("dgm")||D.toLowerCase().includes("dm")?"dgm":"staff";if(await J(E(C,"members"),{...t,email:b,position:D,role:W}),b){const Q=M(C,"roles",b);await ne(Q,{role:W},{merge:!0})}S(a==null?void 0:a.email,"Add Member",`Added: ${t.name} (${W})`)},handleEditMember:async(t,a,b)=>{if(await X(M(C,"members",t),a),a.email||a.role){const D=a.email?a.email.trim().toLowerCase():"";D&&a.role&&await ne(M(C,"roles",D),{role:a.role},{merge:!0})}S(b==null?void 0:b.email,"Edit Member",`Edited: ${a.name}`)},handleDeleteMember:async(t,a)=>{await Y(M(C,"members",t)),S(a==null?void 0:a.email,"Delete Member",`Deleted ID: ${t}`)},handleAddLog:async(t,a)=>{await J(E(C,"logs"),t),S(a==null?void 0:a.email,"Add Log",t.topic)},handleResolveLog:async(t,a,b)=>{await X(M(C,"logs",t),{status:"solved",resolution:a,solvedBy:b==null?void 0:b.email}),S(b==null?void 0:b.email,"Resolve Log",t)},handleDeleteLog:async(t,a)=>{await Y(M(C,"logs",t)),S(a==null?void 0:a.email,"Delete Log",t)},handleSaveRule:async(t,a)=>{if(t.id){const{id:b,...D}=t;await X(M(C,"rules",b),D)}else await J(E(C,"rules"),t);S(a==null?void 0:a.email,"Save Rule",t.condition)},handleDeleteRule:async(t,a)=>{await Y(M(C,"rules",t)),S(a==null?void 0:a.email,"Delete Rule",t)},handleSaveManualScore:async(t,a)=>{await J(E(C,"manualScores"),{...t,timestamp:ue()}),S(a==null?void 0:a.email,"Add Score",`${t.points} pts`)},handleDeleteManualScore:async(t,a)=>{await Y(M(C,"manualScores",t)),S(a==null?void 0:a.email,"Delete Score",t)},handleSaveRole:async(t,a,b)=>{const D=t.trim().toLowerCase(),I=M(C,"roles",D);await ne(I,{role:a},{merge:!0}),S(b==null?void 0:b.email,"Update Role",`${D}->${a}`)}}}function us({activeTab:g,setActiveTab:j,user:c,role:f,onLogout:l,members:i}){var w;const h=c||{},N=h.displayName||((w=h.email)==null?void 0:w.split("@")[0])||"Guest",v=h.email||"",o=i==null?void 0:i.find(y=>y.email===v),x=(o==null?void 0:o.position)||(o==null?void 0:o.role)||f||"Staff",u=f?f.toLowerCase():"staff",n=[{id:"dashboard",label:"Dashboard",icon:Te},{id:"team",label:"จัดการทีมงาน",icon:Z},{id:"dept",label:"ภาพรวมแผนก",icon:Ae},{id:"assign",label:"มอบหมายงาน",icon:ge},{id:"scores",label:"บันทึกคะแนน",icon:ze},{id:"problems",label:"แจ้งปัญหา",icon:de},{id:"rules",label:"กฎระเบียบ",icon:be},{id:"action_logs",label:"ประวัติการแก้ไข",icon:ie,role:["dgm","dm","admin"]}];return e.jsxs("div",{className:"flex flex-col h-full bg-slate-900 text-white shadow-xl",children:[e.jsxs("div",{className:"p-6 border-b border-slate-800",children:[e.jsx("h1",{className:"text-xl font-bold tracking-wider text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-teal-400",children:"TransportOps"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Version 2.0 (Unlocked)"})]}),e.jsx("div",{className:"p-6 bg-slate-800/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-slate-700 rounded-full",children:e.jsx(Le,{size:24,className:"text-slate-300"})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:N}),e.jsx("span",{className:"inline-block mt-1 px-2 py-0.5 rounded text-[10px] font-bold bg-blue-900 text-blue-200 uppercase tracking-wide border border-blue-800",children:x})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto py-4",children:e.jsx("nav",{className:"space-y-1 px-3",children:n.map(y=>y.role&&!y.role.includes(u)?null:e.jsxs("button",{onClick:()=>j(y.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 group ${g===y.id?"bg-blue-600 text-white shadow-lg":"text-slate-400 hover:bg-slate-800 hover:text-white"}`,children:[e.jsx(y.icon,{size:18,className:`transition-colors ${g===y.id?"text-white":"text-slate-500 group-hover:text-white"}`}),y.label]},y.id))})}),e.jsx("div",{className:"p-4 border-t border-slate-800",children:e.jsxs("button",{onClick:l,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium text-slate-400 hover:bg-red-500/10 hover:text-red-400 transition border border-transparent hover:border-red-500/20",children:[e.jsx(Me,{size:18})," ออกจากระบบ"]})})]})}function ms({members:g,tasks:j,logs:c}){const f=g||[],l=j||[],i=c||[],h=l.length,N=l.filter(n=>n.completed||n.status==="done").length,v=h-N,o=h===0?0:Math.round(N/h*100),x=i.filter(n=>n.status==="pending").length,u=i.filter(n=>n.status==="solved").length;return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Transport Overview"}),e.jsx("p",{className:"text-sm text-gray-500",children:"ภาพรวมการดำเนินงานวันนี้"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 bg-white px-3 py-1.5 rounded-lg border border-gray-200 shadow-sm",children:[e.jsx(Re,{size:14}),new Date().toLocaleDateString("th-TH",{dateStyle:"long"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(se,{title:"งานทั้งหมด",value:h,icon:e.jsx(me,{className:"text-blue-600",size:24}),trend:"+12% จากเมื่อวาน",color:"bg-blue-50 text-blue-700"}),e.jsx(se,{title:"งานคงค้าง",value:v,icon:e.jsx(fe,{className:"text-orange-600",size:24}),trend:"ต้องเร่งดำเนินการ",color:"bg-orange-50 text-orange-700"}),e.jsx(se,{title:"ปัญหาที่แจ้ง",value:x,icon:e.jsx(de,{className:"text-red-600",size:24}),trend:`${u} แก้ไขแล้ว`,color:"bg-red-50 text-red-700"}),e.jsx(se,{title:"พนักงานเข้างาน",value:`${f.length} คน`,icon:e.jsx(Z,{className:"text-purple-600",size:24}),trend:"Active Now",color:"bg-purple-50 text-purple-700"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("h3",{className:"font-bold text-lg text-slate-800 flex items-center gap-2",children:[e.jsx(Oe,{className:"text-gray-400",size:20})," ความคืบหน้างานประจำวัน"]})}),e.jsxs("div",{className:"flex items-center gap-6 mb-8",children:[e.jsxs("div",{className:"relative w-32 h-32 flex items-center justify-center",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"#f1f5f9",strokeWidth:"12",fill:"transparent"}),e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"#3b82f6",strokeWidth:"12",fill:"transparent",strokeDasharray:351.86,strokeDashoffset:351.86-351.86*o/100,className:"transition-all duration-1000 ease-out"})]}),e.jsxs("div",{className:"absolute text-center",children:[e.jsxs("span",{className:"text-3xl font-bold text-slate-800",children:[o,"%"]}),e.jsx("p",{className:"text-[10px] text-gray-400 uppercase",children:"Completed"})]})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"Inbound"}),e.jsxs("span",{className:"font-bold text-slate-700",children:[l.filter(n=>n.area==="Inbound"&&n.completed).length," / ",l.filter(n=>n.area==="Inbound").length]})]}),e.jsx("div",{className:"w-full bg-slate-100 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"bg-blue-500 h-full rounded-full",style:{width:`${he(l,"Inbound")}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"Outbound"}),e.jsxs("span",{className:"font-bold text-slate-700",children:[l.filter(n=>n.area==="Outbound"&&n.completed).length," / ",l.filter(n=>n.area==="Outbound").length]})]}),e.jsx("div",{className:"w-full bg-slate-100 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"bg-green-500 h-full rounded-full",style:{width:`${he(l,"Outbound")}%`}})})]})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex flex-col",children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(je,{className:"text-gray-400",size:20})," ปัญหาล่าสุด"]}),e.jsx("div",{className:"flex-1 overflow-y-auto max-h-[300px] space-y-3 pr-2",children:i.length>0?i.slice(0,5).map((n,w)=>{var y;return e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-100 text-sm hover:border-red-200 transition-colors cursor-pointer group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:`px-2 py-0.5 text-[10px] font-bold rounded uppercase ${n.priority==="High"?"bg-red-100 text-red-600":"bg-gray-200 text-gray-600"}`,children:n.priority||"Normal"}),e.jsx("span",{className:"text-[10px] text-gray-400",children:new Date(((y=n.date)==null?void 0:y.seconds)*1e3||Date.now()).toLocaleDateString()})]}),e.jsx("p",{className:"font-medium text-slate-700 line-clamp-2 group-hover:text-blue-600 transition",children:n.topic}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-slate-100 flex items-center gap-1 text-[11px] text-gray-400",children:[e.jsx(Z,{size:12})," ",n.reporter||"Unknown"]})]},n.id||w)}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-300",children:[e.jsx(me,{size:40,className:"mb-2 opacity-50"}),e.jsx("p",{children:"ไม่มีรายการแจ้งปัญหา"})]})}),e.jsxs("button",{className:"w-full mt-4 py-2 text-sm font-bold text-blue-600 bg-blue-50 rounded-lg hover:bg-blue-100 transition flex items-center justify-center gap-1",children:["ดูทั้งหมด ",e.jsx($e,{size:16})]})]})]})]})}function se({title:g,value:j,icon:c,trend:f,color:l}){return e.jsxs("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition cursor-default",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:`p-2 rounded-lg ${l} bg-opacity-20`,children:c}),e.jsx("span",{className:"text-[10px] font-medium px-2 py-1 bg-slate-50 text-slate-500 rounded-full border border-slate-100",children:f})]}),e.jsx("h3",{className:"text-2xl font-bold text-slate-800 mt-2",children:j}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:g})]})}function he(g,j){const c=g.filter(l=>l.area===j);if(c.length===0)return 0;const f=c.filter(l=>l.completed).length;return Math.round(f/c.length*100)}function hs({members:g,onAdd:j,onEdit:c,onDelete:f,currentUserRole:l}){const i=g||[],[h,N]=p.useState(!1),[v,o]=p.useState(null),[x,u]=p.useState({name:"",position:"",dept:"Inbound",tel:"",email:""}),n=()=>{u({name:"",position:"",dept:"Inbound",tel:"",email:""}),o(null),N(!1)},w=s=>{s.preventDefault(),v?c(v,x):j(x),n()},y=s=>{u(s),o(s.id),N(!0)},S=s=>{confirm("ยืนยันการลบ?")&&f(s)},A=["dgm","dm","admin"].includes(l);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(Z,{className:"text-blue-600"})," จัดการทีมงาน"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["พนักงานทั้งหมด: ",i.length," คน"]})]}),A&&e.jsxs("button",{onClick:()=>N(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-700 transition shadow-sm",children:[e.jsx(Ee,{size:18})," เพิ่มพนักงาน"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.length>0?i.map((s,U)=>e.jsxs("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-100 flex flex-col hover:shadow-md transition group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center font-bold text-lg border border-blue-100",children:s!=null&&s.name?s.name.charAt(0).toUpperCase():"?"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-800",children:(s==null?void 0:s.name)||"ไม่ระบุชื่อ"}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500",children:[e.jsx(Ue,{size:12})," ",(s==null?void 0:s.position)||(s==null?void 0:s.role)||"Staff"]})]})]}),e.jsx("span",{className:`text-[10px] font-bold px-2 py-1 rounded uppercase ${(s==null?void 0:s.dept)==="Inbound"?"bg-blue-100 text-blue-600":(s==null?void 0:s.dept)==="Outbound"?"bg-orange-100 text-orange-600":"bg-purple-100 text-purple-600"}`,children:(s==null?void 0:s.dept)||"General"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 flex-1 border-t border-gray-50 pt-3 mt-1",children:[s!=null&&s.tel?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{size:14,className:"text-gray-400"})," ",s.tel]}):e.jsx("div",{className:"text-xs text-gray-300 italic",children:"ไม่มีเบอร์โทร"}),s!=null&&s.email?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{size:14,className:"text-gray-400"})," ",s.email]}):e.jsx("div",{className:"text-xs text-gray-300 italic",children:"ไม่มีอีเมล"})]}),A&&e.jsxs("div",{className:"flex justify-end gap-2 mt-4 pt-3 border-t border-gray-50 opacity-100 transition",children:[e.jsxs("button",{onClick:()=>y(s),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-bold text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition",children:[e.jsx(Ne,{size:14})," แก้ไข"]}),e.jsxs("button",{onClick:()=>S(s.id),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-bold text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition",children:[e.jsx(te,{size:14})," ลบ"]})]})]},(s==null?void 0:s.id)||U)):e.jsxs("div",{className:"col-span-full py-16 flex flex-col items-center justify-center text-center bg-white rounded-2xl border-2 border-dashed border-gray-200",children:[e.jsx(Z,{size:48,className:"text-gray-200 mb-4"}),e.jsx("h3",{className:"text-lg font-bold text-gray-400",children:"ยังไม่มีข้อมูลพนักงาน"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:'กดปุ่ม "เพิ่มพนักงาน" เพื่อเริ่มต้น'})]})}),h&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-6 shadow-2xl animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:v?"แก้ไขข้อมูล":"เพิ่มพนักงานใหม่"}),e.jsx("button",{onClick:n,children:e.jsx(qe,{className:"text-gray-400 hover:text-gray-600"})})]}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500",children:"ชื่อ-นามสกุล"}),e.jsx("input",{required:!0,className:"w-full border rounded-lg px-3 py-2 mt-1",value:x.name,onChange:s=>u({...x,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500",children:"ตำแหน่ง (Position)"}),e.jsx("input",{required:!0,className:"w-full border rounded-lg px-3 py-2 mt-1",value:x.position,onChange:s=>u({...x,position:s.target.value}),placeholder:"เช่น Driver, Admin..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500",children:"แผนก"}),e.jsxs("select",{className:"w-full border rounded-lg px-3 py-2 mt-1",value:x.dept,onChange:s=>u({...x,dept:s.target.value}),children:[e.jsx("option",{value:"Inbound",children:"Inbound"}),e.jsx("option",{value:"Outbound",children:"Outbound"}),e.jsx("option",{value:"Internal",children:"Internal"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500",children:"เบอร์โทร"}),e.jsx("input",{className:"w-full border rounded-lg px-3 py-2 mt-1",value:x.tel,onChange:s=>u({...x,tel:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500",children:"อีเมล (ถ้ามี)"}),e.jsx("input",{className:"w-full border rounded-lg px-3 py-2 mt-1",value:x.email,onChange:s=>u({...x,email:s.target.value})})]}),e.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white py-2.5 rounded-lg hover:bg-blue-700 font-bold shadow-lg shadow-blue-200 mt-2",children:"บันทึกข้อมูล"})]})]})})]})}function ps({members:g,tasks:j,onTaskToggle:c}){const f=g||[],l=j||[],i=N=>({team:f.filter(v=>(v==null?void 0:v.dept)===N),work:l.filter(v=>(v==null?void 0:v.area)===N)}),h=({title:N,icon:v,color:o,data:x})=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:`p-4 border-b border-gray-100 bg-opacity-10 ${o} flex justify-between items-center`,children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-800 font-bold text-lg",children:[v," ",N]}),e.jsxs("div",{className:"text-xs font-bold bg-white px-2 py-1 rounded-full text-slate-500 shadow-sm",children:[x.team.length," คน | ",x.work.length," งาน"]})]}),e.jsxs("div",{className:"p-5 flex-1 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-3",children:"Members"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:x.team.length>0?x.team.map((u,n)=>e.jsx("span",{className:"px-2.5 py-1 text-xs font-medium bg-slate-50 text-slate-600 rounded-md border border-slate-100",children:u.name},u.id||n)):e.jsx("span",{className:"text-xs text-gray-300 italic",children:"- ไม่มีสมาชิก -"})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-3",children:"Tasks"}),e.jsx("div",{className:"space-y-2",children:x.work.length>0?x.work.map((u,n)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-50 rounded-lg border border-slate-100 hover:border-blue-200 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:u.completed,onChange:()=>c(u.id,u.completed),className:"mt-0.5 rounded text-blue-600 cursor-pointer"}),e.jsx("span",{className:`text-sm ${u.completed?"line-through text-gray-400":"text-slate-700"}`,children:u.name})]},u.id||n)):e.jsx("div",{className:"text-center text-xs text-gray-300 py-4 italic",children:"- ไม่มีงานค้าง -"})})]})]})]});return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Department Overview"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 items-start",children:[e.jsx(h,{title:"Inbound",icon:e.jsx(Ve,{className:"text-blue-600"}),color:"bg-blue-500",data:i("Inbound")}),e.jsx(h,{title:"Outbound",icon:e.jsx(Be,{className:"text-green-600"}),color:"bg-green-500",data:i("Outbound")}),e.jsx(h,{title:"Internal",icon:e.jsx(Fe,{className:"text-purple-600"}),color:"bg-purple-500",data:i("Internal")})]})]})}function gs({members:g,manualScores:j,rules:c,onAddScore:f,onDeleteScore:l,currentUserRole:i}){var R,P,$,q;const h=g||[],N=j||[],v=c||[],[o,x]=p.useState(""),[u,n]=p.useState(""),[w,y]=p.useState(""),[S,A]=p.useState(""),s=h.map(d=>{const k=N.filter(L=>L.memberId===d.id).reduce((L,O)=>L+(parseInt(O.points)||0),0);return{...d,totalScore:k}}).sort((d,k)=>k.totalScore-d.totalScore),U=d=>{d.preventDefault();const k=v.find(r=>r.id===u),L=parseInt(k?k.points:w),O=k?k.condition:S||"Custom Score";if(!o||isNaN(L))return alert("กรุณาระบุข้อมูลให้ครบถ้วน");f({memberId:o,points:L,reason:O,date:new Date().toISOString().split("T")[0]}),y(""),A("")};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-xl border border-yellow-100 flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-yellow-100 rounded-full text-yellow-600",children:e.jsx(Ge,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-yellow-700 font-bold uppercase",children:"Top Performer"}),e.jsx("p",{className:"font-bold text-slate-800",children:((R=s[0])==null?void 0:R.name)||"-"}),e.jsxs("p",{className:"text-xs text-slate-500",children:[((P=s[0])==null?void 0:P.totalScore)||0," คะแนน"]})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-100 flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-full text-blue-600",children:e.jsx(je,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-700 font-bold uppercase",children:"Average Score"}),e.jsxs("p",{className:"font-bold text-slate-800",children:[s.length>0?Math.round(s.reduce((d,k)=>d+k.totalScore,0)/s.length):0," คะแนน"]})]})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-xl border border-red-100 flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-red-100 rounded-full text-red-600",children:e.jsx(He,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-700 font-bold uppercase",children:"Needs Improvement"}),e.jsx("p",{className:"font-bold text-slate-800",children:(($=s[s.length-1])==null?void 0:$.name)||"-"}),e.jsxs("p",{className:"text-xs text-slate-500",children:[((q=s[s.length-1])==null?void 0:q.totalScore)||0," คะแนน"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 h-fit",children:[e.jsxs("h3",{className:"font-bold text-slate-700 mb-4 flex items-center gap-2",children:[e.jsx(We,{size:18,className:"text-yellow-500"})," ให้คะแนน"]}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"พนักงาน"}),e.jsxs("select",{required:!0,className:"w-full border rounded-lg px-3 py-2 bg-slate-50",value:o,onChange:d=>x(d.target.value),children:[e.jsx("option",{value:"",children:"-- เลือกพนักงาน --"}),h.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"เลือกตามกฎ"}),e.jsxs("select",{className:"w-full border rounded-lg px-3 py-2",value:u,onChange:d=>n(d.target.value),children:[e.jsx("option",{value:"",children:"-- กำหนดเอง --"}),v.map(d=>e.jsxs("option",{value:d.id,children:[d.condition," (",d.points,")"]},d.id))]})]}),!u&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",placeholder:"คะแนน (+/-)",className:"w-full border rounded-lg px-3 py-2",value:w,onChange:d=>y(d.target.value)}),e.jsx("input",{type:"text",placeholder:"เหตุผล",className:"w-full border rounded-lg px-3 py-2",value:S,onChange:d=>A(d.target.value)})]}),e.jsx("button",{type:"submit",className:"w-full bg-slate-800 text-white py-2.5 rounded-lg hover:bg-slate-900 font-bold shadow-lg",children:"บันทึก"})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b bg-slate-50/50",children:e.jsx("h3",{className:"font-bold text-slate-700",children:"อันดับคะแนนรวม"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-white text-gray-500 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"อันดับ"}),e.jsx("th",{className:"p-3",children:"ชื่อ"}),e.jsx("th",{className:"p-3",children:"แผนก"}),e.jsx("th",{className:"p-3 text-right",children:"คะแนนรวม"})]})}),e.jsx("tbody",{className:"divide-y",children:s.slice(0,5).map((d,k)=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsxs("td",{className:"p-3 pl-5 font-bold text-blue-600",children:["#",k+1]}),e.jsx("td",{className:"p-3 font-medium",children:d.name}),e.jsx("td",{className:"p-3 text-gray-500 text-xs",children:d.dept}),e.jsx("td",{className:`p-3 text-right font-bold ${d.totalScore>=0?"text-green-600":"text-red-600"}`,children:d.totalScore})]},d.id))})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b bg-slate-50/50 flex justify-between",children:e.jsxs("h3",{className:"font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(ie,{size:16})," รายการล่าสุด"]})}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:N.length>0?N.slice(0,10).map(d=>{var k;return e.jsxs("div",{className:"p-3 border-b border-gray-50 flex justify-between items-center hover:bg-slate-50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm text-slate-800",children:((k=h.find(L=>L.id===d.memberId))==null?void 0:k.name)||"Unknown"}),e.jsx("p",{className:"text-xs text-gray-500",children:d.reason})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:`font-bold ${d.points>0?"text-green-600":"text-red-600"}`,children:[d.points>0?"+":"",d.points]}),e.jsx("p",{className:"text-[10px] text-gray-400",children:d.timestamp?new Date(d.timestamp.seconds*1e3).toLocaleDateString("th-TH"):"-"}),["dgm","dm","admin"].includes(i)&&e.jsx("button",{onClick:()=>l(d.id),className:"text-[10px] text-red-400 underline ml-2",children:"ลบ"})]})]},d.id)}):e.jsx("p",{className:"text-center p-4 text-gray-400 text-sm",children:"ยังไม่มีข้อมูล"})})]})]})]})]})}function bs({logs:g,onAddLog:j,onResolveLog:c,onDeleteLog:f,currentDate:l,askAiSolution:i,showToast:h,userEmail:N,currentUserRole:v,aiLoading:o}){const[x,u]=p.useState(""),[n,w]=p.useState(""),[y,S]=p.useState("Inbound"),[A,s]=p.useState("pending"),[U,R]=p.useState(!1),[P,$]=p.useState(""),[q,d]=p.useState(null),[k,L]=p.useState(!1),O=m=>{m.preventDefault(),j({topic:x,detail:n,dept:y,date:l,status:"pending",createdBy:N||"Unknown"}),u(""),w(""),h("บันทึกปัญหาเรียบร้อยแล้ว")},r=m=>{d(m),R(!0)},T=async()=>{if(q)try{L(!0),await c(q,P),R(!1),$(""),d(null),h("ปิดงานเรียบร้อยแล้ว")}catch(m){console.error(m),h("เกิดข้อผิดพลาดในการปิดงาน")}finally{L(!1)}},B=async m=>{if(window.confirm(`⚠️ คุณต้องการลบรายการปัญหานี้ใช่หรือไม่?
(การกระทำนี้ไม่สามารถย้อนกลับได้)`))try{await f(m),h("ลบรายการเรียบร้อยแล้ว")}catch(t){console.error(t),h("เกิดข้อผิดพลาดในการลบ")}},F=g.filter(m=>m.status===A);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(de,{className:"text-red-500"})," Problem Log"]}),U&&e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black bg-opacity-50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md p-6 animate-fade-in",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(we,{className:"text-green-600"})," บันทึกการปิดงาน"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"หมายเหตุ / สรุปการแก้ไข"}),e.jsx("textarea",{className:"w-full border rounded px-3 py-2 h-24",value:P,onChange:m=>$(m.target.value),placeholder:"ระบุรายละเอียดการแก้ไข..."})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-4",children:[e.jsx("button",{onClick:()=>R(!1),disabled:k,className:"px-4 py-2 text-gray-500 hover:bg-gray-100 rounded",children:"ยกเลิก"}),e.jsxs("button",{onClick:T,disabled:k,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 flex items-center gap-2",children:[k&&e.jsx(ye,{size:16,className:"animate-spin"}),"ยืนยันปิดงาน"]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm h-fit",children:[e.jsx("h3",{className:"font-bold mb-4 text-gray-800",children:"แจ้งปัญหาใหม่"}),e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1 uppercase tracking-wide",children:"หัวข้อ"}),e.jsx("input",{required:!0,type:"text",className:"w-full border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-red-200 focus:border-red-400 outline-none transition",value:x,onChange:m=>u(m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1 uppercase tracking-wide",children:"รายละเอียด"}),e.jsx("textarea",{required:!0,className:"w-full border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-red-200 focus:border-red-400 outline-none transition",rows:"3",value:n,onChange:m=>w(m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1 uppercase tracking-wide",children:"แผนก"}),e.jsxs("select",{className:"w-full border rounded-lg px-3 py-2 text-sm bg-white",value:y,onChange:m=>S(m.target.value),children:[e.jsx("option",{value:"Inbound",children:"Inbound"}),e.jsx("option",{value:"Outbound",children:"Outbound"}),e.jsx("option",{value:"Internal",children:"Internal"})]})]}),e.jsx("button",{type:"submit",className:"w-full bg-red-600 text-white py-2.5 rounded-lg hover:bg-red-700 transition font-medium text-sm shadow-md shadow-red-200",children:"บันทึกปัญหา"})]})]}),e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-sm overflow-hidden flex flex-col max-h-[600px]",children:[e.jsxs("div",{className:"flex border-b",children:[e.jsxs("button",{onClick:()=>s("pending"),className:`flex-1 py-3 text-sm font-bold text-center border-b-2 transition ${A==="pending"?"border-red-500 text-red-600 bg-red-50":"border-transparent text-gray-500 hover:bg-gray-50"}`,children:["รอดำเนินการ (",g.filter(m=>m.status==="pending").length,")"]}),e.jsxs("button",{onClick:()=>s("solved"),className:`flex-1 py-3 text-sm font-bold text-center border-b-2 transition ${A==="solved"?"border-green-500 text-green-600 bg-green-50":"border-transparent text-gray-500 hover:bg-gray-50"}`,children:["ปิดงานแล้ว (",g.filter(m=>m.status==="solved").length,")"]})]}),e.jsxs("div",{className:"divide-y overflow-y-auto flex-1",children:[F.length===0?e.jsx("div",{className:"p-10 text-center text-gray-400",children:"ไม่มีรายการในสถานะนี้"}):null,[...F].reverse().map((m,t)=>e.jsx("div",{className:"p-4 hover:bg-gray-50 transition relative group",children:e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-bold text-gray-800 text-sm",children:m.topic}),e.jsxs("span",{className:"text-[10px] text-gray-400",children:["โดย: ",m.createdBy]}),m.status==="pending"&&e.jsxs("button",{onClick:()=>i(m),disabled:o,className:"flex items-center gap-1 px-1.5 py-0.5 bg-indigo-50 text-indigo-600 text-[10px] rounded border border-indigo-100 hover:bg-indigo-100 transition whitespace-nowrap",children:[e.jsx(Ke,{size:10})," ",o?"Thinking...":"Ask AI"]})]}),e.jsx("p",{className:"text-sm text-gray-600 break-words",children:m.detail}),m.status==="solved"&&e.jsxs("div",{className:"mt-2 text-xs bg-green-50 p-2 rounded border border-green-100 text-green-800",children:[e.jsx("strong",{children:"แก้ไขแล้วโดย:"})," ",m.solvedBy," ",e.jsx("br",{}),e.jsx("strong",{children:"หมายเหตุ:"})," ",m.resolution]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold tracking-wider bg-gray-100 px-2 py-0.5 rounded text-gray-600",children:m.dept}),e.jsx("span",{className:"text-[10px] text-gray-400 px-2 py-0.5",children:m.date})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[m.status==="pending"?["dgm","dm"].includes(v)&&e.jsx("button",{onClick:()=>r(m.docId||m.id),className:"px-3 py-1 bg-yellow-100 text-yellow-700 text-xs rounded hover:bg-yellow-200 transition font-bold",children:"ปิดงาน"}):e.jsx("span",{className:"px-2.5 py-1 rounded-full text-[10px] font-bold tracking-wide whitespace-nowrap bg-green-100 text-green-700",children:"SOLVED"}),e.jsx("button",{onClick:()=>B(m.docId||m.id),className:"p-1.5 text-gray-300 hover:text-red-500 hover:bg-red-50 rounded-full transition",title:"ลบรายการ",children:e.jsx(te,{size:14})})]})]})},m.docId||m.id||t))]})]})]})]})}function fs({members:g,tasks:j,onAddTask:c,onEditTask:f,onDeleteTask:l,onUpdateStatus:i,currentUserRole:h}){const N=g||[],v=j||[],[o,x]=p.useState(!1),[u,n]=p.useState(null),[w,y]=p.useState({name:"",area:"Inbound",assigneeId:"",status:"pending",deadline:""}),[S,A]=p.useState(""),[s,U]=p.useState("All"),[R,P]=p.useState("All"),$=()=>{y({name:"",area:"Inbound",assigneeId:"",status:"pending",deadline:""}),n(null),x(!1)},q=r=>{r.preventDefault(),u?f(u.id,w):c({...w,completed:!1,createdAt:new Date().toISOString()}),$()},d=r=>{n(r),y({name:r.name||"",area:r.area||"Inbound",assigneeId:r.assigneeId||"",status:r.status||"pending",deadline:r.deadline||""}),x(!0)},k=r=>{var T;return((T=N.find(B=>B.id===r))==null?void 0:T.name)||"ไม่ระบุ"},L=v.filter(r=>{var t;const T=(t=r.name)==null?void 0:t.toLowerCase().includes(S.toLowerCase()),B=s==="All"||r.area===s,F=r.status==="done"||r.completed;return T&&B&&(R==="All"?!0:R==="Done"?F:!F)}),O=["dgm","dm","admin"].includes(h);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(ge,{className:"text-blue-600"})," มอบหมายงาน"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[L.length," รายการที่แสดง"]})]}),O&&e.jsxs("button",{onClick:()=>x(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-700 shadow-sm transition",children:[e.jsx(Se,{size:18})," สร้างงานใหม่"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col md:flex-row gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 w-full",children:[e.jsx(Qe,{className:"absolute left-3 top-2.5 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"ค้นหาชื่องาน...",className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-100 outline-none text-sm",value:S,onChange:r=>A(r.target.value)})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs("select",{className:"border rounded-lg px-3 py-2 text-sm bg-slate-50 outline-none",value:s,onChange:r=>U(r.target.value),children:[e.jsx("option",{value:"All",children:"ทุกพื้นที่"}),e.jsx("option",{value:"Inbound",children:"Inbound"}),e.jsx("option",{value:"Outbound",children:"Outbound"}),e.jsx("option",{value:"Internal",children:"Internal"})]}),e.jsxs("select",{className:"border rounded-lg px-3 py-2 text-sm bg-slate-50 outline-none",value:R,onChange:r=>P(r.target.value),children:[e.jsx("option",{value:"All",children:"ทุกสถานะ"}),e.jsx("option",{value:"Pending",children:"กำลังทำ"}),e.jsx("option",{value:"Done",children:"เสร็จแล้ว"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:L.map(r=>{const T=r.status==="done"||r.completed;return e.jsxs("div",{className:`bg-white p-4 rounded-xl shadow-sm border transition hover:shadow-md ${T?"border-green-100 bg-green-50/30":"border-gray-100"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold uppercase ${r.area==="Inbound"?"bg-blue-100 text-blue-700":r.area==="Outbound"?"bg-orange-100 text-orange-700":"bg-purple-100 text-purple-700"}`,children:r.area}),O&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>d(r),className:"p-1.5 text-gray-400 hover:text-blue-600 rounded-full",children:e.jsx(Ne,{size:14})}),e.jsx("button",{onClick:()=>confirm("ลบงานนี้?")&&l(r.id),className:"p-1.5 text-gray-400 hover:text-red-600 rounded-full",children:e.jsx(te,{size:14})})]})]}),e.jsx("h3",{className:`font-bold text-slate-800 mb-1 ${T?"line-through text-slate-400":""}`,children:r.name}),e.jsx("div",{className:"flex items-center gap-2 mb-4 text-xs text-gray-500",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-slate-200 flex items-center justify-center text-[10px] font-bold text-slate-600",children:k(r.assigneeId).charAt(0)}),k(r.assigneeId)]})}),e.jsx("div",{className:"pt-3 border-t border-gray-100 flex justify-between items-center",children:e.jsxs("button",{onClick:()=>O&&i(r.id,T?"pending":"done"),disabled:!O,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-bold transition w-full justify-center ${T?"bg-green-500 text-white hover:bg-green-600":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:[T?e.jsx(we,{size:14}):e.jsx(_e,{size:14}),T?"เสร็จสิ้น":"รอการทำงาน"]})})]},r.id)})}),L.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-400 bg-white rounded-xl border border-dashed",children:[e.jsx(Xe,{size:40,className:"mx-auto mb-2 opacity-20"}),e.jsx("p",{children:"ไม่พบรายการงานตามเงื่อนไข"})]}),o&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-6 shadow-2xl animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:u?"แก้ไขงาน":"มอบหมายงานใหม่"}),e.jsx("button",{onClick:$,children:e.jsx(Je,{className:"text-gray-400 hover:text-gray-600"})})]}),e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"ชื่องาน"}),e.jsx("input",{required:!0,className:"w-full border rounded-lg px-3 py-2",value:w.name,onChange:r=>y({...w,name:r.target.value}),placeholder:"เช่น จัดเรียงสินค้า..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"พื้นที่"}),e.jsxs("select",{className:"w-full border rounded-lg px-3 py-2",value:w.area,onChange:r=>y({...w,area:r.target.value}),children:[e.jsx("option",{value:"Inbound",children:"Inbound"}),e.jsx("option",{value:"Outbound",children:"Outbound"}),e.jsx("option",{value:"Internal",children:"Internal"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"ผู้รับผิดชอบ"}),e.jsxs("select",{className:"w-full border rounded-lg px-3 py-2",value:w.assigneeId,onChange:r=>y({...w,assigneeId:r.target.value}),children:[e.jsx("option",{value:"",children:"-- ไม่ระบุ --"}),N.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]})]}),e.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white py-2.5 rounded-lg hover:bg-blue-700 font-bold shadow-lg shadow-blue-200 transition",children:"บันทึกข้อมูล"})]})]})})]})}function js({logs:g}){const j=g||[];return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(ie,{className:"text-blue-600"})," Activity Logs"]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:j.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-gray-100 text-xs uppercase text-gray-500 font-bold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"เวลา"}),e.jsx("th",{className:"p-4",children:"ผู้ใช้งาน"}),e.jsx("th",{className:"p-4",children:"การกระทำ"}),e.jsx("th",{className:"p-4",children:"รายละเอียด"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-50 text-sm",children:j.map((c,f)=>e.jsxs("tr",{className:"hover:bg-slate-50/50 transition",children:[e.jsx("td",{className:"p-4 text-gray-500 text-xs whitespace-nowrap",children:c.timestamp?new Date(c.timestamp.seconds*1e3).toLocaleString("th-TH"):"-"}),e.jsx("td",{className:"p-4 font-bold text-slate-700",children:c.user}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"px-2 py-1 rounded bg-blue-50 text-blue-700 text-xs font-bold border border-blue-100",children:c.action})}),e.jsx("td",{className:"p-4 text-gray-600 max-w-xs truncate",title:c.detail,children:c.detail})]},c.id||f))})]})}):e.jsxs("div",{className:"p-12 text-center text-gray-400 flex flex-col items-center gap-3",children:[e.jsx(fe,{size:40,className:"text-gray-200"}),e.jsx("p",{children:"ยังไม่มีประวัติการใช้งาน"})]})})]})}function vs({rules:g,onSave:j,onDelete:c,currentUserRole:f}){const l=g||[],[i,h]=p.useState({condition:"",points:-5}),N=o=>{o.preventDefault(),j(i),h({condition:"",points:-5})},v=["dgm","dm","admin"].includes(f);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(be,{className:"text-blue-600"})," กฎระเบียบและบทลงโทษ"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:l.length>0?l.map((o,x)=>e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex justify-between items-center hover:shadow-md transition group",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${o.points>0?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:o.points>0?e.jsx(Ye,{size:20}):e.jsx(Ze,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-800",children:o.condition}),e.jsxs("p",{className:"text-xs text-slate-500",children:["ผลกระทบ: ",e.jsxs("span",{className:o.points>0?"text-green-600 font-bold":"text-red-600 font-bold",children:[o.points>0?"+":"",o.points," คะแนน"]})]})]})]}),v&&e.jsx("button",{onClick:()=>c(o.id),className:"p-2 text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition",children:e.jsx(te,{size:18})})]},o.id||x)):e.jsx("div",{className:"text-center p-10 text-gray-400 bg-white rounded-xl border border-dashed",children:"ยังไม่มีกฎระเบียบ"})}),v&&e.jsxs("div",{className:"bg-slate-800 text-white p-6 rounded-2xl h-fit shadow-xl",children:[e.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2",children:[e.jsx(Se,{size:18})," เพิ่มกฎระเบียบใหม่"]}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1",children:"เงื่อนไข/การกระทำ"}),e.jsx("textarea",{required:!0,rows:"3",className:"w-full bg-slate-700 border-none rounded-lg px-3 py-2 text-white placeholder-slate-500",placeholder:"เช่น มาสายเกิน 15 นาที...",value:i.condition,onChange:o=>h({...i,condition:o.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1",children:"คะแนน (ใส่ลบเพื่อตัดแต้ม)"}),e.jsx("input",{required:!0,type:"number",className:"w-full bg-slate-700 border-none rounded-lg px-3 py-2 text-white placeholder-slate-500",placeholder:"-10",value:i.points,onChange:o=>h({...i,points:parseInt(o.target.value)})})]}),e.jsx("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-500 py-2.5 rounded-lg font-bold transition shadow-lg shadow-blue-900/50",children:"บันทึกกฎระเบียบ"})]})]})]})]})}function Ns({onLogin:g}){const j=p.useMemo(()=>"admin@tsops.com".toLowerCase(),[]),c=p.useMemo(()=>"pass1234",[]),[f,l]=p.useState(j),[i,h]=p.useState(c),[N,v]=p.useState(!1),[o,x]=p.useState(""),u=async n=>{n.preventDefault(),v(!0),x("");try{if(f.trim().toLowerCase()===j&&i===c){g==null||g({email:j,displayName:"Admin",providerId:"local-admin"});return}await ts(re,f,i)}catch(w){console.error("Login Failed:",w),w.code==="auth/invalid-credential"||w.code==="auth/user-not-found"||w.code==="auth/wrong-password"?x("อีเมลหรือรหัสผ่านไม่ถูกต้อง"):w.code==="auth/too-many-requests"?x("ล็อกอินผิดหลายครั้ง กรุณารอสักครู่"):x("เกิดข้อผิดพลาดในการเชื่อมต่อ")}finally{v(!1)}};return e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden flex flex-col md:flex-row",children:e.jsxs("div",{className:"w-full p-8 md:p-10",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800 tracking-tight",children:"TransportOPS"}),e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"เข้าสู่ระบบเพื่อจัดการงานขนส่ง"})]}),e.jsxs("form",{onSubmit:u,className:"space-y-5",children:[o&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-600 text-xs p-3 rounded-lg flex items-center gap-2",children:[e.jsx(es,{size:16})," ",o]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-bold text-slate-700 uppercase tracking-wider",children:"อีเมล"}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"email",required:!0,className:"w-full pl-10 pr-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition text-sm",placeholder:"name@company.com",value:f,onChange:n=>l(n.target.value)})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-bold text-slate-700 uppercase tracking-wider",children:"รหัสผ่าน"}),e.jsxs("div",{className:"relative",children:[e.jsx(ss,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"password",required:!0,className:"w-full pl-10 pr-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition text-sm",placeholder:"••••••••",value:i,onChange:n=>h(n.target.value)})]})]}),e.jsx("button",{type:"submit",disabled:N,className:"w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-2.5 rounded-lg transition shadow-lg hover:shadow-xl disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:N?e.jsx(ye,{className:"animate-spin",size:20}):"เข้าสู่ระบบ"})]}),e.jsx("p",{className:"mt-8 text-center text-xs text-slate-400",children:"© 2024 Transport Operations System"})]})})})}let pe=null;function ws(){var H,K,ee;const[g,j]=p.useState(null),[c,f]=p.useState(null),[l,i]=p.useState("dashboard"),[h,N]=p.useState(!0),[v,o]=p.useState(!1),x=xs(g||c)||{},{members:u=[],tasks:n=[],logs:w=[],actionLogs:y=[],rules:S=[],manualScores:A=[],roles:s={},handleTaskToggle:U,handleUpdateTaskStatus:R,handleAddTask:P,handleEditTask:$,handleDeleteTask:q,handleAddMember:d,handleEditMember:k,handleDeleteMember:L,handleAddLog:O,handleResolveLog:r,handleDeleteLog:T,handleSaveRule:B,handleDeleteRule:F,handleSaveManualScore:m,handleDeleteManualScore:t,handleSaveRole:a}=x;p.useEffect(()=>{const z=as(re,V=>j(V));return()=>z()},[]);const b=async()=>{await ds(re),f(null)},D=z=>rs.success(z),I=z=>(...V)=>{if(z)return z(...V,g||c)},W="admin@tsops.com".toLowerCase(),Q=(K=(H=g||c)==null?void 0:H.email)==null?void 0:K.toLowerCase(),G=Q===W?"dgm":(s==null?void 0:s[Q])||"staff",_=async z=>{if(!pe)return alert("API Key Missing");o(!0);try{const ae=await pe.getGenerativeModel({model:"gemini-pro"}).generateContent(`แนะนำวิธีแก้ปัญหา: ${z.topic} ${z.detail}`);alert(`AI Suggestion:
${ae.response.text()}`)}catch{alert("AI Error")}finally{o(!1)}};return!g&&!c?e.jsx(Ns,{onLogin:z=>f(z)}):e.jsxs("div",{className:"flex h-screen bg-gray-50 font-sans text-gray-900 overflow-hidden",children:[e.jsx(ls,{position:"top-right"}),e.jsx("div",{className:`fixed inset-y-0 left-0 z-50 w-64 bg-slate-900 text-white transform transition-transform duration-300 lg:static lg:translate-x-0 ${h?"translate-x-0":"-translate-x-full"}`,children:e.jsx(us,{activeTab:l,setActiveTab:z=>{i(z),N(!1)},user:g||c,role:G,onLogout:b,members:u})}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 overflow-hidden",children:[e.jsxs("div",{className:"lg:hidden bg-white p-4 shadow-sm flex items-center justify-between",children:[e.jsx("span",{className:"font-bold text-lg text-slate-800",children:"TransportOps"}),e.jsx("button",{onClick:()=>N(!h),className:"p-2 text-gray-600",children:e.jsx(ns,{})})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4 lg:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[l==="dashboard"&&e.jsx(ms,{members:u||[],tasks:n||[],logs:w||[]}),l==="team"&&e.jsx(hs,{members:u||[],onAdd:I(d),onEdit:I(k),onDelete:I(L),currentUserRole:G}),l==="dept"&&e.jsx(ps,{members:u||[],tasks:n||[],onTaskToggle:I(U)}),l==="scores"&&e.jsx(gs,{members:u||[],manualScores:A||[],rules:S||[],tasks:n||[],onAddScore:I(m),onDeleteScore:I(t),currentUserRole:G}),l==="problems"&&e.jsx(bs,{logs:w||[],onAddLog:I(O),onResolveLog:I(r),onDeleteLog:I(T),currentDate:new Date().toLocaleDateString("th-TH"),askAiSolution:_,showToast:D,userEmail:(ee=g||c)==null?void 0:ee.email,currentUserRole:G,aiLoading:v}),l==="assign"&&e.jsx(fs,{members:u||[],tasks:n||[],onAddTask:I(P),onEditTask:I($),onDeleteTask:I(q),onUpdateStatus:I(R),currentUserRole:G}),l==="action_logs"&&e.jsx(js,{logs:y||[]}),l==="rules"&&e.jsx(vs,{rules:S||[],onSave:I(B),onDelete:I(F),currentUserRole:G,roles:s||{},onSaveRole:I(a)})]})})]}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden",onClick:()=>N(!1)})]})}is.createRoot(document.getElementById("root")).render(e.jsx(os.StrictMode,{children:e.jsx(ws,{})}));
